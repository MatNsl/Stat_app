---
title: "Readable densities"
output:
  pdf_document: default
  html_document: default
date: "2024-05-15"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
source(file = "~/work/Stat_app/DATA/exporting_data_from_link.R")
```

```{r}
#Packages :
install.packages("dplyr")
install.packages("ggplot2")
install.packages("labelled")
library("dplyr")
library("ggplot2")
library("labelled")

# Add this package for %>%
library("magrittr")
```

```{r}
install.packages("reshape2")
```

```{r}

### First step: the number of hours people usually work globally
# Get the density estimate
dens1 <- density(eulfs_small$hwusual, na.rm = TRUE)
# Need to delete some values for the number of working hours, to have a clearer graph
# Need for x and y with the same length
n <- length(dens1[[1]])
dens1[[1]] <- dens1[[1]][!(dens1[[1]] < 0)]
n_1 <- length(dens1[[1]])
loss_1 <- n - n_1 # number of first elements that were deleted
dens1[[1]] <- dens1[[1]][!(dens1[[1]] > 80)]
loss_2 <- n_1 - length(dens1[[1]]) # number of last elements that were deleted
dens1[[2]] <- tail(dens1[[2]],-loss_1)
dens1[[2]] <- head(dens1[[2]], -loss_2)

# Let's focus on the people who wish to work 40 hours
eulfs_40wish <- eulfs_small %>% filter(hwwish == 40)

### Second step: the number of hours people usually work when they wish to work 40 hours
# Get the density estimate
dens3 <- density(eulfs_40wish$hwusual, na.rm = TRUE)
# Need to delete negative values for the number of working hours, as well as the values above 80 hours which are absent to the dataset
# Need for x and y with the same length
n <- length(dens3[[1]])
dens3[[1]] <- dens3[[1]][!(dens3[[1]] < 0)]
n_1 <- length(dens3[[1]])
loss_1 <- n - n_1 # number of first elements that were deleted
dens3[[1]] <- dens3[[1]][!(dens3[[1]] > 80)]
loss_2 <- n_1 - length(dens3[[1]]) # number of last elements that were deleted
dens3[[2]] <- tail(dens3[[2]],-loss_1)
dens3[[2]] <- head(dens3[[2]], -loss_2)

# Let's focus on the people who wish to work 40 hours but who don't work 40
eulfs_no40 <- eulfs_small %>% filter(hwwish == 40, hwusual != 40)

### Second step: the number of hours people usually work when they wish to work 40 hours
# Get the density estimate
dens2 <- density(eulfs_no40$hwusual, na.rm = TRUE)
# Need to delete negative values for the number of working hours, as well as the values above 80 hours which are absent to the dataset
# Need for x and y with the same length
n <- length(dens2[[1]])
dens2[[1]] <- dens2[[1]][!(dens2[[1]] < 0)]
n_1 <- length(dens2[[1]])
loss_1 <- n - n_1 # number of first elements that were deleted
dens2[[1]] <- dens2[[1]][!(dens2[[1]] > 80)]
loss_2 <- n_1 - length(dens2[[1]]) # number of last elements that were deleted
dens2[[2]] <- tail(dens2[[2]],-loss_1)
dens2[[2]] <- head(dens2[[2]], -loss_2)

### Plot
# Plot y-values scaled by number of observations against x values
par(mar = c(5.1, 5.1, 4.1, 2.1))
plot <- plot(dens1$x, dens1$y,type="l",xlab="Number of hours",ylab="", main = "Distribution of the number of hours", las = 1)
lines(dens3$x, dens3$y, col = "darkorchid2")
lines(dens2$x, dens2$y, col = "orange")
title(ylab = "Proportion of people", line = 3) # a readable y-label

```
Figure 3. **People find their number of working hours somewhat satisfactory**. Density of the number of hours usually worked: in black for all workers combined, in purple for people who wish to work 40 hours in their main job and in orange for people who wish to work 40 hours but usually do not. All years combined. 31 countries from the 2014 release of the EU Labor Force Survey, own analyses.


```{r}

```
