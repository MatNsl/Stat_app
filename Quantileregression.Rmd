---
title: "Quantile regression"
author: "Gabrielle Durieu"
date: "2024-03-25"
output:
  pdf_document: default
  html_document: default
---
  
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r echo = F, message = F, warning = F}
source(file = "~/work/Stat_app/DATA/exporting_data_from_link.R")
```

```{r echo = F, message = F, warning = F}
#Packages :
install.packages("dplyr")
install.packages("ggplot2")
install.packages("labelled")
install.packages("quantreg") # regression
install.packages("lmtest") # statistic tests
install.packages("stargazer") # tables
install.packages("xtable")

library("dplyr")
library("ggplot2")
library("labelled")
library("quantreg")
library("stargazer")
library("xtable")
library("magrittr") # for %>%

```


```{r}
#Reg for a given year

quantiles <- seq(0.1, 0.9, by = 0.1)
eulfs_small_year <- subset(eulfs_small, refyear == 2013)


# Initialise a list to stock the results
results <- list()

# Loop  on each quantile
for (q in quantiles) {
  # Ajust the quant reg model
  rq_model <- rq(hwactual ~ sex, data = eulfs_small_year, tau = q)
  
  # Stock the results in the list
  results[[as.character(q)]] <- summary(rq_model)
}

# Print the results for each quantile
for (q in quantiles) {
  cat("Quantile:", q, "\n")
  print(results[[as.character(q)]])
}

```
```{r}
# Regressions for a given year
quantiles <- seq(0.1, 0.9, by = 0.1)
eulfs_small_year <- subset(eulfs_small, refyear == 1998)

# Initialize a list to store the results
results <- list()

# Loop over each quantile
for (q in quantiles) {
  # Fit the quantile regression model
  rq_model <- rq(hwactual ~ sex, data = eulfs_small_year, tau = q)
  
  # Store the results in the list
  results[[as.character(q)]] <- summary(rq_model)
}

# Convert the results to LaTeX using xtable
table_data <- NULL
for (q in quantiles) {
  table_data <- rbind(table_data, c(q, results[[as.character(q)]]$coef[,1]))
}
colnames(table_data) <- c("Quantile", "Intercept", "sex")

# Convert to xtable object
xtable_data <- xtable(table_data)

# Print the LaTeX code for the table
xtable_data

```



