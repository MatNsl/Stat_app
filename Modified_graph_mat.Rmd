---
title: "Modified_graph_Mat"
output: html_document
date: "2024-02-27"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
source(file = "~/work/Stat_app/DATA/exporting_data_from_link.R")
```

```{r}
source(file="~/work/Stat_app/Countries/countries_code.R")
```

```{r}
#Packages :
install.packages("dplyr")
install.packages("ggplot2")
install.packages("labelled")
library("dplyr")
library("ggplot2")
library("labelled")

# Add this package for %>%
library("magrittr")
```

```{r}
# Get the density estimate
dens <- density(eulfs_small$hwactual, na.rm = TRUE)
# Need to delete negative values for the number of working hours, as well as the values above 80 hours which are absent to the dataset
# Need for x and y with the same length
n <- length(dens[[1]])
dens[[1]] <- dens[[1]][!(dens[[1]] < 0)]
n_1 <- length(dens[[1]])
loss_1 <- n - n_1 # number of first elements that were deleted
dens[[1]] <- dens[[1]][!(dens[[1]] > 80)]
loss_2 <- n_1 - length(dens[[1]]) # number of last elements that were deleted
dens[[2]] <- tail(dens[[2]],-loss_1)
dens[[2]] <- head(dens[[2]], -loss_2)
# Plot y-values scaled by number of observations against x values
plot <- plot(dens$x,length(eulfs_small$hwactual)*dens$y,type="l",xlab="Number of hours",ylab="Number of people", main = "Distribution of the numbers of hours")
```
Figure 1. \textbf{The vast majority of Europeans work between 35 and 40 hours a week but those who work the least represent a strong minority.} Histogram of the number of hours actually worked, all years combined. 31 countries from the 2014 release of the EU Labor Force Survey, own analyses.

The peak of the distribution is clearly between 35 and 40 hours with more than 40000 people.
But the second most important interval is between 0 and 5 hours.

--------------------

```{r}
# An histogram about the number of hours that the person would like to work in total in a week
hist(eulfs_small$hwwish, col = "skyblue",
     main = "Distribution of the numbers of hours people wish",
     xlab = "Number of hours",
     ylab = "Number of people")
```
Figure 2. \textbf{The vast majority of Europeans want to work between 35 and 40 hours a week.} Histogram of the number of hours people wish to work, all years combined. 31 countries from the 2014 release of the EU Labor Force Survey, own analyses.

By contrast with the number of hours actually worked, there is almost no one who want to work less than 5 hours a week. Europeans tend to be unanimous on this issue.

---------------

```{r}
# Boxplot to compare men and women concerning the number of hours actually worked in main job
boxplot(eulfs_small$hwactual ~ eulfs_small$sex,
        xlab = " ",
        ylab = "Number of hours",
        names = c("Men", "Women"),
        col = c("blue", "red"),
        main = "Actual weekly working hours: men and women"
)

```
Figure 3. \textbf{Although the median number of working hours is almost the same for each sex, the variability is much higher for women.} Boxplot of the number of hours actually worked depending on sex, all years combined. 31 countries from the 2014 release of the EU Labor Force Survey, own analyses.

The variability is much higher for female workers: their first quartile that is close from the minimum of men.

---------------

We may analyse data for a specific country, for instance Austria.

```{r fig.cap= ""}
# Starting by creating a smaller base to work with
eulfs_AT <- eulfs_small %>% filter(country == 1) %>% select(hwactual, refyear)
# Indicating what statistics we want to appear on the plot
frame <- eulfs_AT %>% group_by(refyear, .drop = NA) %>% summarise(Min = min(hwactual, na.rm = TRUE), Max = max(hwactual, na.rm = TRUE), Median = median(hwactual, na.rm = TRUE), quant1 = quantile(hwactual, probs = 0.25, na.rm = TRUE), quant2 = quantile(hwactual, probs = 0.75, na.rm = TRUE))
# Creating the graph
p <- ggplot(frame, aes(x = refyear, na.rm = TRUE)) + geom_line(aes(y=Min)) + geom_line(aes(y=Max), color = "green") + geom_line(aes(y=Median), color = "darkred") + geom_line(aes(y=quant1), color = "blue") + geom_line(aes(y=quant2), color = "red") + labs(title = "Actual weekly working hours in 1st job in Austria", x=" ", y="Number of weekly working hours")
# Plotting the graph
p
```
Figure 4. \textbf{Those who work the least tend to have less and less working hours in recent years in Austria.} A few order statistics concerning Austria: the minimum, the three quartiles and the maximum of the number of hours actually worked in main job. From the 2014 release of the EU Labor Force Survey, own analyses.

We notice that all quartiles remain somewhat stable, except the first quartile.
Indeed, the quarter of the population who work the least has less and less working hours.
The number of hours dropped below 20 hours after 2010.

```{r fig.cap= ""}
##An histogram of the mean of the number of hours actually worked in main job by country  

# Convert the "country" variable to a factor for correct visualization in the bar plot
eulfs_small$country <- as.factor(eulfs_small$country)

# Remove values 99 (not applicable) from the hwactual variable
eulfs_small$hwactual <- na_if(eulfs_small$hwactual, 99)

# Filter data to exclude NA values in the hwactual variable
eulfs_filtered_country <- eulfs_small %>% filter(!is.na(hwactual))

# Calculate the mean of the number of hours worked for each country
mean_by_country <- eulfs_filtered_country %>%
  group_by(country) %>%
  summarise(mean_hwactual = mean(hwactual, na.rm = TRUE))
# Merge mean_by_country with countries_code
mean_by_country <- merge(mean_by_country, countries_code, by = "country")


mean_value_EU <- mean(eulfs_filtered_country$hwactual)

# Create a horizontal bar plot
ggplot(mean_by_country, aes(x = mean_hwactual, y = reorder(country_name, -mean_hwactual))) +
  
  # Add horizontal bars to the plot
  geom_col(width = 0.7) +
  # Add labels and title to the plot
  labs(
    title = "Mean of the Number of Hours Worked per Week, per Country",
    x = "Mean of Hours Worked per week",
    y = "Country"
  ) +
  geom_vline(xintercept = mean_value_EU, linetype = "solid", color = "red") +
  # Set the theme to minimal
  theme_minimal()
```

Figure 5. **Average weekly working hours varies considerably between countries.** Values range from 27.46 hours a week in the Netherlands to 40.10 in Greece, with an average for the 31 countries of **34.63** (represented by the red line on the graph).Arithmetic mean of usual working hours, 31 countries from the 2014 release of the EU Labor Force Survey, own analyses.

```{r}
# Convert the "year" and "country" variable to a factor for correct visualization in the histogram
eulfs_small$year <- as.factor(eulfs_small$year)
eulfs_small$country <- as.factor(eulfs_small$country)

# Remove values 99 (not applicable) from the hwactual variable
eulfs_small$hwactual <- na_if(eulfs_small$hwactual, 99)
# Filter data to exclude NA values in the hwactual variable
eulfs_filtered <- eulfs_small %>% filter(!is.na(hwactual))
eulfs_filtered <- merge(eulfs_filtered, countries_code, by="country")

mean_by_country_year <- eulfs_filtered %>%
  group_by(country_name, year) %>%
  summarise(mean_hwactual = mean(hwactual, na.rm = TRUE))
mean_by_country_year<- mean_by_country_year %>%
  filter(country_name != "Malta")
mean_by_country_year$year <- as.numeric(as.character(mean_by_country_year$year))

ggplot(mean_by_country_year, aes_string(x = "year", y = "mean_hwactual",group=1)) +
  geom_line() +
  labs(
    title = "Mean of the Number of Hours Worked per Week by Year",
    x = "",
    y = "Actual weekly hours in first job"
  ) +
  theme_minimal()+
  ylim(25,45)+
  facet_wrap(~country_name)+
  scale_x_continuous(breaks = c(2000,2005,2010))+
  theme(panel.grid = element_blank())

```


Figure 6. **Average weekly working hours are declining over time**. Bar chart of average weekly working hours over time. Arithmetic mean of usual working hours, 31 countries from the 2014 release of the EU Labor Force Survey, own analyses.
