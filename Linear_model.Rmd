---
title: "Linear model"
output:
  pdf_document: default
  html_document: default
date: "2024-03-11"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
source(file = "~/work/Stat_app/DATA/exporting_data_from_link.R")
```

```{r}
#Packages :
install.packages("dplyr")
install.packages("ggplot2")
install.packages("labelled")
library("dplyr")
library("ggplot2")
library("labelled")

# Add this package for %>%
library("magrittr")
```

Source:
https://search.r-project.org/CRAN/refmans/miceadds/html/lm.cluster.html
```{r}
### Failed attempts
# install.packages("miceadds")
# install.packages("clusterSEs")
# model <- miceadds::lm.cluster(formula = hwactual ~ sex, cluster= eulfs_small$country, data = eulfs_small)
## Problem: we do not have the correct intercept (44.69 instead of 37.81)

# get_p_value()
# model2 <- lm(formula = hwactual ~ sex, data = eulfs_small)
## One problem to solve: not as much information with cluster as with a simple linear regression.

# glm(formula = hwactual ~ sex, cluster= eulfs_small$country, data = eulfs_small)


# clusterSEs::cluster.bs.glm(
#      model,
#      eulfs_small,
#      eulfs_small$country)
```

```{r}
install.packages("sandwich")
```

```{r}
install.packages("lmtest")
```

```{r}
install.packages("stargazer")
```

```{r}
reg <- lm(formula = hwactual ~ sex, data = eulfs_small)
v_country = sandwich::vcovCL(reg, cluster = ~country)
reg_year = lmtest::coeftest(reg, v_country)
```

```{r}
stargazer::stargazer(reg, title = "Actual working hours regressed on sex, standard errors account for clustering by countries", column.labels = c("Number of hours actually worked in main job"), covariate.labels = c("Sex (1 for male and 2 for female)", "Constant"), model.names = TRUE, keep.stat="n", omit.stat = c("rsq", "adj.rsq","ser","f"))

```
% Table created by stargazer v.5.2.3 by Marek Hlavac, Social Policy Institute. E-mail: marek.hlavac at gmail.com
% Date and time: Sun, Mar 24, 2024 - 05:22:43 PM
\begin{table}[!htbp] \centering 
  \caption{Actual working hours regressed on sex, standard errors account for clustering by countries} 
  \label{} 
\begin{tabular}{@{\extracolsep{5pt}}lc} 
\\[-1.8ex]\hline 
\hline \\[-1.8ex] 
 & \multicolumn{1}{c}{\textit{Dependent variable:}} \\ 
\cline{2-2} 
\\[-1.8ex] & hwactual \\ 
\\[-1.8ex] & \textit{OLS} \\ 
 & Number of hours actually worked in main job \\ 
\hline \\[-1.8ex] 
 Sex (1 for male and 2 for female) & $-$6.884$^{***}$ \\ 
  & (0.094) \\ 
  & \\ 
 Constant & 44.693$^{***}$ \\ 
  & (0.145) \\ 
  & \\ 
\hline \\[-1.8ex] 
Observations & 109,479 \\ 
\hline 
\hline \\[-1.8ex] 
\textit{Note:}  & \multicolumn{1}{r}{$^{*}$p$<$0.1; $^{**}$p$<$0.05; $^{***}$p$<$0.01} \\ 
\end{tabular} 
\end{table}
